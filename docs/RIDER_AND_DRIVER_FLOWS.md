# Rider and Driver Flows - Complete Guide

> **Last Updated:** January 2026  
> **Status:** Production-Ready  
> **Purpose:** Complete mapping of all user flows, screens, and API calls for Rider and Driver apps

---

## Table of Contents

1. [Flow Diagrams](#flow-diagrams)
   - [Rider Journey Diagram](#rider-journey-diagram)
   - [Driver Journey Diagram](#driver-journey-diagram)
   - [Bidding System Diagram](#bidding-system-diagram)
2. [Rider Flow](#rider-flow)
   - [Booking a Ride](#1-booking-a-ride-flow)
   - [During Trip](#2-during-trip-flow)
   - [After Trip](#3-after-trip-flow)
   - [Profile Management](#4-profile-management-flow)
3. [Driver Flow](#driver-flow)
   - [Going Online](#1-going-online-flow)
   - [Accepting Trips](#2-accepting-trips-flow)
   - [During Trip](#3-during-trip-flow)
   - [Completing Trip](#4-completing-trip-flow)
   - [Earnings & Management](#5-earnings--management)
4. [API Endpoints Reference](#api-endpoints-reference)
5. [Real-time Updates](#real-time-updates)
6. [State Management](#state-management)

---

## Flow Diagrams

### Rider Journey Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          RIDER JOURNEY FLOW                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚  Open App    â”‚
                              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚ Onboarding Complete? â”‚
                          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚       â”‚
                        NO â—„â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â–º YES
                         â”‚                       â”‚
                         â–¼                       â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
              â”‚ Welcome Tutorial â”‚               â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
                       â”‚                         â”‚
                       â–¼                         â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
            â”‚ Permissions Setup   â”‚              â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
                       â”‚                         â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚ Login/Auth   â”‚
                        â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚  RiderMapScreen - IDLE     â”‚
                  â”‚  â€¢ See current location    â”‚
                  â”‚  â€¢ View nearby drivers     â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â”‚ Tap "Where to?"
                               â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚  SearchLocationScreen      â”‚
                  â”‚  â€¢ Autocomplete search     â”‚
                  â”‚  â€¢ Saved places            â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â”‚ Select Destination
                               â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚  VIEWING_FARE Phase        â”‚
                  â”‚  ğŸ“ Green Pin â†’ Red Pin    â”‚
                  â”‚  ğŸ“ Green Dashed Polyline  â”‚
                  â”‚  â€¢ Select vehicle type     â”‚
                  â”‚  â€¢ View/adjust fare        â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â”‚ Tap "Find Ride"
                               â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚  SEARCHING Phase           â”‚
                  â”‚  â€¢ Looking for drivers...  â”‚
                  â”‚  â€¢ Poll for bids (3s)      â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚ Bids Received?  â”‚
                     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
                          â”‚        â”‚
                     NO â—„â”€â”˜        â””â”€â–º YES
                      â”‚                 â”‚
                      â–¼                 â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Timeout (3 min)? â”‚  â”‚  SELECTING Phase           â”‚
            â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â”‚  â€¢ View bid cards          â”‚
                 â”‚        â”‚       â”‚  â€¢ Compare drivers         â”‚
            YES â—„â”˜        â””â–º NO   â”‚  â€¢ Rating, ETA, Fare       â”‚
             â”‚               â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚               â”‚                 â”‚
             â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ Continue polling
             â”‚                                  â”‚
             â–¼                                  â”‚ Accept Bid
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
      â”‚ No Drivers Alert â”‚                     â”‚
      â”‚ â€¢ Increase fare? â”‚                     â”‚
      â”‚ â€¢ Try again?     â”‚                     â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
               â”‚                               â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º Retry or Cancel     â”‚
                                               â–¼
                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                  â”‚  DRIVER_ASSIGNED Phase     â”‚
                                  â”‚  ğŸ“ Blue Car â†’ Green Pin   â”‚
                                  â”‚  ğŸ“ Blue Solid Polyline    â”‚
                                  â”‚  â€¢ Real-time tracking      â”‚
                                  â”‚  â€¢ ETA updates (5s)        â”‚
                                  â”‚  â€¢ Call/Chat/Share         â”‚
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
                                               â”‚ Driver arrives
                                               â–¼
                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                  â”‚  DRIVER_ARRIVED Phase      â”‚
                                  â”‚  â€¢ Driver waiting          â”‚
                                  â”‚  â€¢ 5 min countdown         â”‚
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
                                               â”‚ Rider boards + Start trip
                                               â–¼
                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                  â”‚  IN_PROGRESS Phase         â”‚
                                  â”‚  ğŸ“ Black Car â†’ Red Pin    â”‚
                                  â”‚  ğŸ“ Black Solid Polyline   â”‚
                                  â”‚  â€¢ Live tracking           â”‚
                                  â”‚  â€¢ SOS available           â”‚
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
                                               â”‚ Arrive at destination
                                               â–¼
                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                  â”‚  COMPLETED Phase           â”‚
                                  â”‚  ğŸ“ Gray Polyline          â”‚
                                  â”‚  â€¢ Trip summary            â”‚
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
                                               â–¼
                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                  â”‚  Rate Trip Screen          â”‚
                                  â”‚  â€¢ Rate driver (1-5 â­)    â”‚
                                  â”‚  â€¢ Add tip                 â”‚
                                  â”‚  â€¢ Leave feedback          â”‚
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
                                               â”‚ Submit
                                               â–¼
                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                  â”‚  View Receipt              â”‚
                                  â”‚  â€¢ Trip details            â”‚
                                  â”‚  â€¢ Payment breakdown       â”‚
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
                                               â”‚
                                               â””â”€â”€â”€â”€â”€â”€â–º Back to IDLE
```

---

### Driver Journey Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          DRIVER JOURNEY FLOW                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚  Open App    â”‚
                              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚ Documents Verified?  â”‚
                          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚       â”‚
                        NO â—„â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â–º YES
                         â”‚                       â”‚
                         â–¼                       â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
              â”‚ Upload Documents â”‚               â”‚
              â”‚ â€¢ License        â”‚               â”‚
              â”‚ â€¢ Insurance      â”‚               â”‚
              â”‚ â€¢ Vehicle docs   â”‚               â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
                       â”‚                         â”‚
                       â–¼                         â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
            â”‚ Admin Review Pendingâ”‚              â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
                       â”‚                         â”‚
                  Approved?                      â”‚
                       â”‚                         â”‚
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚  DriverMapScreen - OFFLINE â”‚
                  â”‚  â€¢ Stats: $0, 0 trips      â”‚
                  â”‚  â€¢ Big "GO ONLINE" button  â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â”‚ Tap "GO ONLINE"
                               â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚ Requirements Check: â”‚
                     â”‚ â€¢ Vehicle selected? â”‚
                     â”‚ â€¢ Location enabled? â”‚
                     â”‚ â€¢ Daily fee paid?   â”‚
                     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚        â”‚
                     FAIL â—„â”˜       â””â”€â–º PASS
                      â”‚                 â”‚
                      â”‚                 â–¼
                      â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚    â”‚  ONLINE_AVAILABLE Phase    â”‚
                      â”‚    â”‚  ğŸŸ¢ Status: Online         â”‚
                      â”‚    â”‚  â€¢ Poll trips (10s)        â”‚
                      â”‚    â”‚  â€¢ View nearby requests    â”‚
                      â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚                 â”‚
                      â”‚                 â”‚ Trips available
                      â”‚                 â–¼
                      â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚    â”‚  View Trip Cards           â”‚
                      â”‚    â”‚  â€¢ Pickup/Dropoff          â”‚
                      â”‚    â”‚  â€¢ Estimated fare          â”‚
                      â”‚    â”‚  â€¢ Distance                â”‚
                      â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚                 â”‚
                      â”‚                 â”‚ Interested?
                      â”‚                 â–¼
                      â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚    â”‚  Place Bid Screen          â”‚
                      â”‚    â”‚  â€¢ Enter bid amount        â”‚
                      â”‚    â”‚  â€¢ Add message (optional)  â”‚
                      â”‚    â”‚  â€¢ Submit bid              â”‚
                      â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚                 â”‚
                      â”‚                 â”‚ Poll my bids (5s)
                      â”‚                 â–¼
                      â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚         â”‚ Bid Accepted? â”‚
                      â”‚         â””â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
                      â”‚             â”‚       â”‚
                      â”‚        NO â—„â”€â”˜       â””â”€â–º YES
                      â”‚         â”‚               â”‚
                      â”‚    Keep polling         â–¼
                      â”‚         â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚         â”‚    â”‚  ğŸ‰ ACCEPTED Phase         â”‚
                      â”‚         â”‚    â”‚  â€¢ Vibration + Sound       â”‚
                      â”‚         â”‚    â”‚  â€¢ Load trip details       â”‚
                      â”‚         â”‚    â”‚                            â”‚
                      â”‚         â”‚    â”‚  âš ï¸ Notification Stacking: â”‚
                      â”‚         â”‚    â”‚  â€¢ Multiple trip requests  â”‚
                      â”‚         â”‚    â”‚    should be stacked/      â”‚
                      â”‚         â”‚    â”‚    grouped in notification â”‚
                      â”‚         â”‚    â”‚    tray (e.g., "3 new      â”‚
                      â”‚         â”‚    â”‚    trip requests")         â”‚
                      â”‚         â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚         â”‚                 â”‚
                      â”‚         â”‚                 â–¼
                      â”‚         â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚         â”‚    â”‚  ARRIVING Phase            â”‚
                      â”‚         â”‚    â”‚  ğŸ“ Orange Car â†’ Green Pin â”‚
                      â”‚         â”‚    â”‚  ğŸ“ Blue Solid Polyline    â”‚
                      â”‚         â”‚    â”‚  â€¢ Navigate button         â”‚
                      â”‚         â”‚    â”‚  â€¢ ETA to pickup           â”‚
                      â”‚         â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚         â”‚                 â”‚
                      â”‚         â”‚                 â”‚ Arrive at pickup
                      â”‚         â”‚                 â–¼
                      â”‚         â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚         â”‚    â”‚  Tap "I've Arrived"        â”‚
                      â”‚         â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚         â”‚                 â”‚
                      â”‚         â”‚                 â–¼
                      â”‚         â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚         â”‚    â”‚  ARRIVED_AT_PICKUP Phase   â”‚
                      â”‚         â”‚    â”‚  â€¢ Wait for rider          â”‚
                      â”‚         â”‚    â”‚  â€¢ 5 min timer             â”‚
                      â”‚         â”‚    â”‚  â€¢ Call/Chat               â”‚
                      â”‚         â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚         â”‚                 â”‚
                      â”‚         â”‚                 â”‚ Rider boards
                      â”‚         â”‚                 â–¼
                      â”‚         â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚         â”‚    â”‚  Verify & Start Trip       â”‚
                      â”‚         â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚         â”‚                 â”‚
                      â”‚         â”‚                 â–¼
                      â”‚         â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚         â”‚    â”‚  IN_PROGRESS Phase         â”‚
                      â”‚         â”‚    â”‚  ğŸ“ Orange Car â†’ Red Pin   â”‚
                      â”‚         â”‚    â”‚  ğŸ“ Black Solid Polyline   â”‚
                      â”‚         â”‚    â”‚  â€¢ Navigate to destination â”‚
                      â”‚         â”‚    â”‚  â€¢ Real-time tracking      â”‚
                      â”‚         â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚         â”‚                 â”‚
                      â”‚         â”‚                 â”‚ Arrive at destination
                      â”‚         â”‚                 â–¼
                      â”‚         â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚         â”‚    â”‚  Tap "Complete Trip"       â”‚
                      â”‚         â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚         â”‚                 â”‚
                      â”‚         â”‚                 â–¼
                      â”‚         â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚         â”‚    â”‚  COMPLETING Phase          â”‚
                      â”‚         â”‚    â”‚  â€¢ Trip summary            â”‚
                      â”‚         â”‚    â”‚  â€¢ Rate rider (1-5 â­)     â”‚
                      â”‚         â”‚    â”‚  â€¢ Optional feedback       â”‚
                      â”‚         â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚         â”‚                 â”‚
                      â”‚         â”‚                 â”‚ Submit
                      â”‚         â”‚                 â–¼
                      â”‚         â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚         â”‚    â”‚  Earnings Updated          â”‚
                      â”‚         â”‚    â”‚  â€¢ Today: +$14.00          â”‚
                      â”‚         â”‚    â”‚  â€¢ Trips: +1               â”‚
                      â”‚         â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚         â”‚                 â”‚
                      â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â–º Back to ONLINE_AVAILABLE
                      â”‚
                      â””â”€â”€â–º Fix Requirements & Retry

                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚ Tap "GO OFFLINE"   â”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
                                               â–¼
                                    Back to OFFLINE Phase
```

---

### Bidding System Flow (Sequence)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BIDDING SYSTEM - SEQUENCE FLOW                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  RIDER              BACKEND API         DATABASE        WEBSOCKET       DRIVER 1/2/3
    â”‚                     â”‚                  â”‚                â”‚                â”‚
    â”‚  Book Trip          â”‚                  â”‚                â”‚                â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                  â”‚                â”‚                â”‚
    â”‚  (auto_dispatch:    â”‚  Create Trip     â”‚                â”‚                â”‚
    â”‚   false)            â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚                â”‚
    â”‚                     â”‚ (status:         â”‚                â”‚                â”‚
    â”‚                     â”‚  'searching')    â”‚                â”‚                â”‚
    â”‚                     â”‚                  â”‚                â”‚                â”‚
    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                  â”‚                â”‚                â”‚
    â”‚  Trip Created       â”‚                  â”‚                â”‚                â”‚
    â”‚  (trip_id: 12345)   â”‚                  â”‚                â”‚                â”‚
    â”‚                     â”‚                  â”‚                â”‚                â”‚
    â”‚ ğŸ” SEARCHING...     â”‚                  â”‚                â”‚  Poll Availableâ”‚
    â”‚                     â”‚                  â”‚                â”‚  Trips (10s)   â”‚
    â”‚                     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                     â”‚  GET /trips/     â”‚                â”‚                â”‚
    â”‚                     â”‚  available       â”‚                â”‚                â”‚
    â”‚                     â”‚                  â”‚                â”‚                â”‚
    â”‚                     â”‚  [New Trip]      â”‚                â”‚                â”‚
    â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚                     â”‚                  â”‚                â”‚  View Trip     â”‚
    â”‚                     â”‚                  â”‚                â”‚  Details       â”‚
    â”‚                     â”‚                  â”‚                â”‚                â”‚
    â”‚                     â”‚  Place Bid 1     â”‚                â”‚                â”‚
    â”‚                     â”‚  ($15.50, 5 min) â”‚                â”‚                â”‚
    â”‚                     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                     â”‚                  â”‚                â”‚  DRIVER 1      â”‚
    â”‚                     â”‚  Save Bid        â”‚                â”‚                â”‚
    â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚                â”‚
    â”‚                     â”‚ (status:pending) â”‚                â”‚                â”‚
    â”‚                     â”‚                  â”‚                â”‚                â”‚
    â”‚                     â”‚  Emit Event      â”‚                â”‚                â”‚
    â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚
    â”‚                     â”‚  'bid.received'  â”‚                â”‚                â”‚
    â”‚                     â”‚                  â”‚                â”‚                â”‚
    â”‚  ğŸ”” New Bid!        â”‚                  â”‚                â”‚                â”‚
    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”‚
    â”‚  Vibrate + Show     â”‚                  â”‚                â”‚                â”‚
    â”‚  Bid Card           â”‚                  â”‚                â”‚                â”‚
    â”‚                     â”‚                  â”‚                â”‚                â”‚
    â”‚                     â”‚  Place Bid 2     â”‚                â”‚                â”‚
    â”‚                     â”‚  ($14.00, 8 min) â”‚                â”‚                â”‚
    â”‚                     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                     â”‚                  â”‚                â”‚  DRIVER 2      â”‚
    â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚                â”‚
    â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚
    â”‚  ğŸ”” New Bid!        â”‚                  â”‚                â”‚                â”‚
    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”‚
    â”‚                     â”‚                  â”‚                â”‚                â”‚
    â”‚                     â”‚  Place Bid 3     â”‚                â”‚                â”‚
    â”‚                     â”‚  ($16.00, 3 min) â”‚                â”‚                â”‚
    â”‚                     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                     â”‚                  â”‚                â”‚  DRIVER 3      â”‚
    â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚                â”‚
    â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚
    â”‚  ğŸ”” New Bid!        â”‚                  â”‚                â”‚                â”‚
    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                â”‚
    â”‚                     â”‚                  â”‚                â”‚                â”‚
    â”‚ ğŸ‘€ Review 3 Bids:   â”‚                  â”‚                â”‚                â”‚
    â”‚  D1: $15.50, â­4.8  â”‚                  â”‚                â”‚                â”‚
    â”‚  D2: $14.00, â­4.9 âœ“â”‚                  â”‚                â”‚                â”‚
    â”‚  D3: $16.00, â­4.7  â”‚                  â”‚                â”‚                â”‚
    â”‚                     â”‚                  â”‚                â”‚                â”‚
    â”‚  Accept Bid 2       â”‚                  â”‚                â”‚                â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                  â”‚                â”‚                â”‚
    â”‚  (Driver 2)         â”‚                  â”‚                â”‚                â”‚
    â”‚                     â”‚  Update Bid 2    â”‚                â”‚                â”‚
    â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚                â”‚
    â”‚                     â”‚ (status:accepted)â”‚                â”‚                â”‚
    â”‚                     â”‚                  â”‚                â”‚                â”‚
    â”‚                     â”‚  Update Trip     â”‚                â”‚                â”‚
    â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚                â”‚
    â”‚                     â”‚ (driver_id: D2)  â”‚                â”‚                â”‚
    â”‚                     â”‚                  â”‚                â”‚                â”‚
    â”‚                     â”‚  Reject Bid 1,3  â”‚                â”‚                â”‚
    â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚                â”‚
    â”‚                     â”‚                  â”‚                â”‚                â”‚
    â”‚                     â”‚  Notify All      â”‚                â”‚                â”‚
    â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚  âœ… Accepted!  â”‚
    â”‚                     â”‚                  â”‚                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚                     â”‚                  â”‚                â”‚  DRIVER 2      â”‚
    â”‚                     â”‚                  â”‚                â”‚  ğŸ‰ Vibrate    â”‚
    â”‚                     â”‚                  â”‚                â”‚                â”‚
    â”‚                     â”‚                  â”‚                â”‚  âŒ Rejected   â”‚
    â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
    â”‚                     â”‚                  â”‚                â”‚  DRIVER 1/3    â”‚
    â”‚                     â”‚                  â”‚                â”‚                â”‚
    â”‚ ğŸ“ DRIVER_ASSIGNED  â”‚                  â”‚                â”‚  Load Trip     â”‚
    â”‚  Track Driver 2     â”‚                  â”‚                â”‚  Navigate to   â”‚
    â”‚                     â”‚                  â”‚                â”‚  Pickup        â”‚
    â”‚                     â”‚                  â”‚                â”‚                â”‚
    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ REAL-TIME UPDATES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
    â”‚    â”‚                â”‚                  â”‚                â”‚           â”‚    â”‚
    â”‚    â”‚                â”‚  Update Location â”‚                â”‚           â”‚    â”‚
    â”‚    â”‚                â”‚  (every 5s)      â”‚                â”‚           â”‚    â”‚
    â”‚    â”‚                â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤
    â”‚    â”‚                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚           â”‚    â”‚
    â”‚    â”‚                â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚           â”‚    â”‚
    â”‚    â”‚  Update Map    â”‚  'driver.        â”‚                â”‚           â”‚    â”‚
    â”‚    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€location.â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤           â”‚    â”‚
    â”‚    â”‚  Driver Marker â”‚   updated'       â”‚                â”‚           â”‚    â”‚
    â”‚    â”‚  Blue Polyline â”‚                  â”‚                â”‚           â”‚    â”‚
    â”‚    â”‚  ETA: 5 min    â”‚                  â”‚                â”‚           â”‚    â”‚
    â”‚    â”‚                â”‚                  â”‚                â”‚           â”‚    â”‚
    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
    â”‚                     â”‚                  â”‚                â”‚                â”‚
    â”‚  ğŸ”” Driver Arrived! â”‚  POST /arrive    â”‚                â”‚  Tap "Arrived" â”‚
    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚                â”‚
    â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚
    â”‚                     â”‚  'driver.arrived'â”‚                â”‚                â”‚
    â”‚                     â”‚                  â”‚                â”‚                â”‚
    â”‚ ğŸ“ DRIVER_ARRIVED   â”‚                  â”‚                â”‚  Wait for Riderâ”‚
    â”‚                     â”‚                  â”‚                â”‚                â”‚
    â”‚  Rider boards       â”‚  POST /start     â”‚                â”‚  Tap "Start"   â”‚
    â”‚                     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚                â”‚
    â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚
    â”‚ ğŸ“ IN_PROGRESS      â”‚  'trip.started'  â”‚                â”‚                â”‚
    â”‚  Black Polyline     â”‚                  â”‚                â”‚  Navigate to   â”‚
    â”‚  To Destination     â”‚                  â”‚                â”‚  Destination   â”‚
    â”‚                     â”‚                  â”‚                â”‚                â”‚
    â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ TRACKING TO DESTINATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
    â”‚    â”‚                â”‚  Location Updatesâ”‚                â”‚           â”‚    â”‚
    â”‚    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤
    â”‚    â”‚  ETA: 12 min   â”‚  (every 5s)      â”‚                â”‚           â”‚    â”‚
    â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
    â”‚                     â”‚                  â”‚                â”‚                â”‚
    â”‚  ğŸ‰ Trip Complete!  â”‚  POST /complete  â”‚                â”‚  Tap "Complete"â”‚
    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚                â”‚
    â”‚                     â”‚ (final_fare)     â”‚                â”‚                â”‚
    â”‚                     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚
    â”‚                     â”‚  'trip.completed'â”‚                â”‚                â”‚
    â”‚                     â”‚                  â”‚                â”‚                â”‚
    â”‚ ğŸ“ COMPLETED        â”‚                  â”‚                â”‚  Earnings      â”‚
    â”‚  Rate Driver        â”‚                  â”‚                â”‚  Updated       â”‚
    â”‚                     â”‚                  â”‚                â”‚  +$14.00       â”‚
    â–¼                     â–¼                  â–¼                â–¼                â–¼
```

---

### Map Visualization States

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      MAP VISUALIZATION STATES                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   IDLE STATE     â”‚
â”‚                  â”‚
â”‚  Markers:        â”‚
â”‚  â€¢ Blue circle   â”‚â”€â”€â”€â”€â”€â”€â”
â”‚    (User)        â”‚      â”‚
â”‚  â€¢ Gray cars     â”‚      â”‚ Enter Destination
â”‚    (Available    â”‚      â”‚
â”‚     Drivers)     â”‚      â”‚
â”‚                  â”‚      â”‚
â”‚  Polyline: None  â”‚      â”‚
â”‚  Camera: Zoom 15 â”‚      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
                          â”‚
                          â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  VIEWING_FARE STATE   â”‚
              â”‚                       â”‚
              â”‚  Markers:             â”‚
              â”‚  â€¢ ğŸŸ¢ Green Pin       â”‚â”€â”€â”€â”€â”€â”€â”
              â”‚    (Pickup)           â”‚      â”‚
              â”‚  â€¢ ğŸ”´ Red Pin         â”‚      â”‚ Book Ride
              â”‚    (Dropoff)          â”‚      â”‚
              â”‚                       â”‚      â”‚
              â”‚  Polyline:            â”‚      â”‚
              â”‚  â€¢ Green Dashed       â”‚      â”‚
              â”‚    (Estimated Route)  â”‚      â”‚
              â”‚                       â”‚      â”‚
              â”‚  Camera:              â”‚      â”‚
              â”‚  â€¢ Fit both markers   â”‚      â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
                                             â”‚
                                             â–¼
                             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                             â”‚  SEARCHING STATE          â”‚
                             â”‚                           â”‚
                             â”‚  Markers:                 â”‚
                             â”‚  â€¢ ğŸŸ¢ Green Pin (Pickup)  â”‚â”€â”€â”€â”€â”€â”€â”
                             â”‚  â€¢ ğŸ”´ Red Pin (Dropoff)   â”‚      â”‚
                             â”‚  â€¢ ğŸš— Gray Cars           â”‚      â”‚
                             â”‚    (Nearby Drivers)       â”‚      â”‚ Bids Received
                             â”‚                           â”‚      â”‚
                             â”‚  Polyline:                â”‚      â”‚
                             â”‚  â€¢ Green Dashed           â”‚      â”‚
                             â”‚    (Estimated Route)      â”‚      â”‚
                             â”‚                           â”‚      â”‚
                             â”‚  + Loading animation      â”‚      â”‚
                             â”‚  + Poll for bids          â”‚      â”‚
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
                                                            â”‚
                                                            â–¼
                                           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                           â”‚  SELECTING STATE       â”‚
                                           â”‚  (Map still visible)   â”‚â”€â”€â”€â”€â”€â”€â”
                                           â”‚  + Bids overlay        â”‚      â”‚
                                           â”‚  + Compare drivers     â”‚      â”‚ Accept Bid
                                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
                                                                           â”‚
                                                                           â–¼
                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                          â”‚  DRIVER_ASSIGNED STATE          â”‚
                                          â”‚                                 â”‚
                                          â”‚  Markers:                       â”‚
                                          â”‚  â€¢ ğŸš— Black Car (Driver)        â”‚
                                          â”‚    - Rotates with heading       â”‚
                                          â”‚    - Updates every 5s           â”‚
                                          â”‚  â€¢ ğŸŸ¢ Green Pin (Pickup)        â”‚
                                          â”‚                                 â”‚
                                          â”‚  Polyline:                      â”‚
                                          â”‚  â€¢ ğŸ”µ Blue Solid                â”‚
                                          â”‚    (Driver â†’ Pickup)            â”‚
                                          â”‚    - 5px width                  â”‚
                                          â”‚    - Updates with driver        â”‚
                                          â”‚                                 â”‚
                                          â”‚  Camera:                        â”‚
                                          â”‚  â€¢ Fit both markers             â”‚
                                          â”‚  â€¢ Follow driver (optional)     â”‚
                                          â”‚  â€¢ Update every 5s              â”‚
                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                       â”‚
                                                       â”‚ Driver Arrives
                                                       â–¼
                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                          â”‚  DRIVER_ARRIVED STATE           â”‚
                                          â”‚                                 â”‚
                                          â”‚  Markers:                       â”‚
                                          â”‚  â€¢ ğŸš— Black Car (stationary)    â”‚
                                          â”‚  â€¢ ğŸŸ¢ Green Pin (Pickup)        â”‚
                                          â”‚                                 â”‚
                                          â”‚  Polyline: None                 â”‚
                                          â”‚  (Driver at pickup)             â”‚
                                          â”‚                                 â”‚
                                          â”‚  Camera:                        â”‚
                                          â”‚  â€¢ Show both (close zoom)       â”‚
                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                       â”‚
                                                       â”‚ Trip Starts
                                                       â–¼
                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                          â”‚  IN_PROGRESS STATE              â”‚
                                          â”‚                                 â”‚
                                          â”‚  Markers:                       â”‚
                                          â”‚  â€¢ ğŸš— Black Car (Driver)        â”‚
                                          â”‚    - Rotates with heading       â”‚
                                          â”‚    - Updates every 5s           â”‚
                                          â”‚  â€¢ ğŸ”´ Red Pin (Destination)     â”‚
                                          â”‚                                 â”‚
                                          â”‚  Polyline:                      â”‚
                                          â”‚  â€¢ â¬› Black Solid                â”‚
                                          â”‚    (Driver â†’ Destination)       â”‚
                                          â”‚    - 6px width                  â”‚
                                          â”‚    - Updates with driver        â”‚
                                          â”‚                                 â”‚
                                          â”‚  Camera:                        â”‚
                                          â”‚  â€¢ Follow driver to destination â”‚
                                          â”‚  â€¢ Fit route in view            â”‚
                                          â”‚                                 â”‚
                                          â”‚  Special:                       â”‚
                                          â”‚  â€¢ Traffic layer ON             â”‚
                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                       â”‚
                                                       â”‚ Arrive
                                                       â–¼
                                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                          â”‚  COMPLETED STATE                â”‚
                                          â”‚                                 â”‚
                                          â”‚  Markers:                       â”‚
                                          â”‚  â€¢ ğŸ”´ Red Pin (Destination)     â”‚
                                          â”‚                                 â”‚
                                          â”‚  Polyline:                      â”‚
                                          â”‚  â€¢ â¬œ Gray Solid                 â”‚
                                          â”‚    (Complete route)             â”‚
                                          â”‚    - 4px width                  â”‚
                                          â”‚    - Historical view            â”‚
                                          â”‚                                 â”‚
                                          â”‚  Camera:                        â”‚
                                          â”‚  â€¢ Center on destination        â”‚
                                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        POLYLINE COLOR REFERENCE                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸŸ¢ Green Dashed  (#34A853)  â†’  Estimated route (fare preview)             â”‚
â”‚  ğŸ”µ Blue Solid    (#1E88E5)  â†’  Driver en route to pickup                  â”‚
â”‚  â¬› Black Solid   (#000000)  â†’  Trip in progress to destination            â”‚
â”‚  â¬œ Gray Solid    (#9E9E9E)  â†’  Completed trip (historical)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
```

---

## Rider Flow

### Overview
The rider app uses a **unified single-screen experience** with `RiderMapScreen` handling all phases on one screen with a persistent map and dynamic bottom panel.

### 1. Booking a Ride Flow

#### Phase: IDLE
**Screen:** `RiderMapScreen` (Idle Phase)

**UI Elements:**
- Map showing current location
- Nearby drivers displayed as car markers
- Search bar: "Where to?"
- Pickup location (auto-detected)

**User Actions:**
1. Tap "Where to?" search bar
2. App navigates to `SearchLocationScreen`

**API Calls:**
```typescript
// Get current location
await Location.getCurrentPositionAsync()

// Fetch nearby drivers
const response = await riderApi.getNearbyDrivers(latitude, longitude, 5)
// Returns: { drivers: NearbyDriver[], count: number }

// Reverse geocode for pickup address
const address = await googlePlacesService.reverseGeocode(latitude, longitude)
```

---

#### Phase: ENTERING_DESTINATION
**Screen:** `SearchLocationScreen` (Modal)

**UI Elements:**
- Search input with autocomplete
- Saved places (Home, Work)
- Recent searches
- "Pick on Map" toggle

**User Actions:**
1. Type destination in search box
2. See autocomplete results
3. Select destination OR use map picker

**API Calls:**
```typescript
// Search places (autocomplete)
const results = await googlePlacesService.searchPlaces(query, currentLocation)
// Returns: PlacePrediction[]

// Get place details (on selection)
const details = await googlePlacesService.getPlaceDetails(placeId)
// Returns: { geometry: { location: { lat, lng } } }

// On selection, navigate back with location and address
onSelect(location, address)
```

---

#### Phase: VIEWING_FARE
**Screen:** `RiderMapScreen` (Fare Estimation Panel)

**UI Elements:**
- Map with route polyline (green)
- Pickup and dropoff markers
- Vehicle type selector (horizontal scroll)
  - Economy ($X.XX)
  - Standard ($X.XX)
  - Premium ($X.XX)
  - SUV ($X.XX)
  - Wheelchair Accessible ($X.XX)
- Editable fare input with +/- buttons
- Distance and duration display
- "Find Ride" button

**User Actions:**
1. Review route on map
2. Select vehicle type
3. Adjust offered fare (optional)
4. Tap "Find Ride"

**API Calls:**
```typescript
// Get actual driving route from Google Directions API
const directionsResult = await googlePlacesService.getDirections(
  pickupLocation,
  destinationLocation,
  'driving'
)
// Returns: { distance, duration, routeCoordinates, polyline }

// Estimate fare for each vehicle type (called in parallel)
const response = await tripsApi.estimateFare({
  pickup_latitude: number,
  pickup_longitude: number,
  dropoff_latitude: number,
  dropoff_longitude: number,
  vehicle_type: 'economy' | 'standard' | 'premium' | 'suv' | 'wheelchair'
})
// Returns: { estimate: { estimated_total, distance_km, duration_minutes } }
```

**Fare Calculation:**
```typescript
// Base fare formula
const baseFare = 2.50
const perKmRate = 1.50
const estimatedPrice = baseFare + (distanceKm * perKmRate)

// Vehicle type multipliers
economy: 0.85x
standard: 1.0x
premium: 1.5x
suv: 1.3x
wheelchair: 1.2x
```

---

#### Phase: NEGOTIATING (Optional)
**Screen:** `FareNegotiationScreen` (Modal)

**Features:**
- Â±30% fare range allowed
- Max 3 negotiation rounds
- Auto-accept if within 10% of estimate
- Driver response timeout: 30 seconds

**API Calls:**
```typescript
// Submit negotiation offer
const response = await negotiationsApi.submitProposal(tripId, proposedFare, message)

// Listen for driver counter-offers (real-time)
pusherService.onNegotiationUpdate(tripId, (data) => {
  // Handle negotiation response
})
```

---

#### Phase: SEARCHING
**Screen:** `RiderMapScreen` (Searching Panel)

**Map Visualization:**
- **Pickup marker** (green pin) at pickup location
- **Dropoff marker** (red pin) at destination
- **Route polyline** (green dashed line) showing estimated route
- **Nearby driver markers** (gray car icons) showing available drivers in the area
- All markers remain visible during search

**UI Elements:**
- Loading animation
- "Looking for nearby drivers"
- Cancel button

**User Actions:**
- Wait for driver bids to come in
- Can cancel search (cancels all pending bids and prevents driver notifications)

**Important Behaviors:**
- âš ï¸ **Cancellation During Searching:** When rider cancels during searching phase:
  - All pending bids are marked as 'cancelled'
  - Trip status changes to 'cancelled'
  - Drivers who already received notification should be notified of cancellation
  - Future driver notifications for this trip should NOT be sent
  - Trip becomes redundant and should not appear in driver's available trips

**API Calls:**
```typescript
// Book trip
const response = await tripsApi.bookTrip({
  pickup_latitude: number,
  pickup_longitude: number,
  pickup_address: string,
  dropoff_latitude: number,
  dropoff_longitude: number,
  dropoff_address: string,
  vehicle_type: 'standard',
  payment_method: 'cash',
  offered_fare: number (optional),
  auto_dispatch: boolean // false = bidding system, true = instant match
})
// Returns: { trip: Trip }

// Poll for bids (if auto_dispatch = false)
setInterval(async () => {
  const bidsResponse = await tripsApi.getTripBids(tripId)
  // Returns: { bids: Bid[] }
}, 3000)

// Or use real-time updates (recommended)
const { bids, latestBid, newBidCount } = useBids(tripId)
```

---

#### Phase: SELECTING (Viewing Bids)
**Screen:** `TripBidsScreen` (Full screen) OR `RiderMapScreen` (Bids Panel)

**Navigation:**
- Auto-navigate when first bid arrives
- OR tap notification to view bids

**UI Elements:**
- List of driver bids (sorted by amount or ETA)
- Each bid card shows:
  - Driver photo/avatar
  - Driver name and rating
  - Vehicle info (type, color, make/model)
  - Bid amount (fare offer)
  - ETA to pickup
  - "View Profile" button
  - "Accept" button
- "Decline All" or "Cancel Trip" option

**Bid Card Details:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [Photo]  John Smith â­ 4.8        â”‚
â”‚           Honda Civic (Red)         â”‚
â”‚           ABC-1234                  â”‚
â”‚                                     â”‚
â”‚  Offer: $15.50    ETA: 5 min       â”‚
â”‚  [View Profile]     [Accept Bid]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**User Actions:**
1. Review incoming bids as they arrive
2. Compare drivers (rating, vehicle, fare, ETA)
3. Tap driver to view full profile
4. Select a bid and tap "Accept"
5. Confirm acceptance

**API Calls:**
```typescript
// Get trip bids (polling)
const response = await tripsApi.getTripBids(tripId)
// Returns: { 
//   bids: [{
//     id: string,
//     trip_id: string,
//     driver_id: string,
//     driver: {
//       name: string,
//       rating: number,
//       photo_url: string,
//       total_trips: number
//     },
//     vehicle: {
//       make: string,
//       model: string,
//       color: string,
//       license_plate: string,
//       type: string
//     },
//     amount: number,
//     eta_minutes: number,
//     message: string,
//     status: 'pending' | 'accepted' | 'rejected',
//     created_at: string,
//     expires_at: string
//   }]
// }

// Real-time bid updates (recommended)
pusherService.onBidReceived(tripId, (bidData) => {
  // New bid arrived!
  Vibration.vibrate(200)
  setLatestBid(bidData)
  setBids(prev => [...prev, bidData])
})

// Get driver profile (optional)
const driverResponse = await riderApi.getDriverProfile(driverId)
// Returns: { 
//   driver: { ...details },
//   rating_summary: { average_rating, total_trips, badges },
//   recent_reviews: Review[]
// }

// Accept bid
const response = await tripsApi.acceptBid(tripId, bidId)
// Returns: { 
//   trip: Trip (with driver assigned),
//   driver: Driver,
//   message: 'Bid accepted successfully'
// }

// After acceptance, other bids are auto-rejected
```

**Real-time Bid Notifications:**
```typescript
// Hook for managing bids
const { bids, latestBid, newBidCount, clearNewBidCount } = useBids(tripId)

// Visual/audio notification for new bid
useEffect(() => {
  if (latestBid) {
    // Show toast notification
    Toast.show({
      type: 'success',
      text1: 'New Bid Received!',
      text2: `${latestBid.driver.name} - $${latestBid.amount}`
    })
    
    // Play notification sound
    playNotificationSound()
    
    // Vibrate
    Vibration.vibrate(200)
  }
}, [latestBid])
```

**Bid Sorting Options:**
- Sort by price (lowest first)
- Sort by ETA (fastest first)
- Sort by rating (highest first)
- Sort by time (newest first)

**Bid Expiration:**
- Bids typically expire after 2-3 minutes
- Show countdown timer per bid
- Auto-remove expired bids
- Driver can withdraw bid before acceptance

**No Bids Scenario:**
```typescript
// After 2-3 minutes of searching with no bids
if (bids.length === 0 && searchTime > 180000) {
  Alert.alert(
    'No Drivers Available',
    'No drivers responded to your request. Try adjusting your fare or try again later.',
    [
      { text: 'Increase Fare', onPress: () => navigation.goBack() },
      { text: 'Try Again', onPress: () => retryBooking() },
      { text: 'Cancel', onPress: () => cancelTrip() }
    ]
  )
}
```

---

### 2. During Trip Flow

#### Phase: DRIVER_ASSIGNED
**Screen:** `RiderMapScreen` (Driver Panel)

**Map Visualization:**
- **Driver marker** (car icon) at driver's current location
- **Pickup marker** (green pin) at rider's pickup location
- **Route polyline** (blue line) from driver â†’ pickup location
- Camera auto-adjusts to show both driver and pickup in view
- Driver marker updates in real-time as driver moves

**UI Elements:**
- Driver photo/avatar
- Driver name and rating
- Vehicle info (make, model, color, plate)
- ETA to pickup (updates in real-time)
- Distance to pickup (e.g., "2.3 km away")
- Action buttons: Call, Chat, Share, Cancel

**Real-time Updates:**
```typescript
// Subscribe to trip updates
const { tripStatus, driverLocation } = useTripUpdates(tripId)

// Driver location updates (every 5 seconds)
pusherService.onDriverLocationUpdated(tripId, (data) => {
  updateDriverLocation(data)
  // Update driver marker on map
  setDriverMarker({
    latitude: data.latitude,
    longitude: data.longitude,
    rotation: data.heading
  })
  // Recalculate route polyline if needed
  updateRouteToPickup(data.latitude, data.longitude, pickupLocation)
})
// data: { latitude, longitude, heading, eta_minutes }

// Trip status changes
pusherService.onTripStatusChanged(tripId, (data) => {
  updatePhaseFromStatus(data.status)
})
```

**API Calls:**
```typescript
// Get driver location
const response = await trackingApi.getDriverLocation(tripId)
// Returns: { driver: { latitude, longitude, heading }, vehicle: { ... } }

// Get ETA
const etaResponse = await trackingApi.getTripETA(tripId)
// Returns: { eta_minutes, distance_km, traffic_condition }

// Call driver
handleCallDriver() {
  const telUrl = `tel:${driverPhone}`
  Linking.openURL(telUrl)
}

// Open chat
navigation.navigate('TripChat', { tripId })
```

---

#### Phase: DRIVER_ARRIVED
**Screen:** `RiderMapScreen` (Driver Waiting Panel)

**UI Elements:**
- "Driver waiting" status
- Countdown timer (5 minutes)
- Same action buttons

**Behavior:**
- Driver arrived notification (vibration + alert)
- 5-minute countdown starts
- Map shows driver at pickup location

---

#### Phase: IN_PROGRESS
**Screen:** `RiderMapScreen` (Trip Progress Panel)

**UI Elements:**
- "On your way" status
- Destination address
- ETA to destination
- Distance remaining
- Progress bar
- Fare display
- Action buttons: Call, Chat, Share, SOS

**Real-time Updates:**
```typescript
// Continuous driver location updates
const { location, eta } = useDriverLocation(tripId)

// Route progress
const response = await trackingApi.getRouteProgress(tripId)
// Returns: { completed_distance_km, remaining_distance_km, completed_percentage }
```

**Safety Features:**
```typescript
// Share trip
const response = await safetyApi.shareTrip(tripId, {
  contact_ids: emergencyContactIds,
  share_duration_minutes: 120
})

// Trigger emergency SOS
const response = await safetyApi.triggerEmergency({
  trip_id: tripId,
  location: currentLocation,
  type: 'panic'
})
```

---

### 3. After Trip Flow

#### Phase: COMPLETED
**Screen:** `RiderMapScreen` (Completion Panel)

**UI Elements:**
- "You've arrived!" message
- Trip fare display
- "Rate your trip" button

**User Actions:**
1. Tap "Rate your trip"
2. Navigate to `RateTripScreen`

---

#### Rating Screen
**Screen:** `RateTripScreen` (Modal)

**UI Elements:**
- Star rating (1-5)
- Feedback categories/tags
- Comment box
- Tip options (10%, 15%, 20%, Custom)

**API Calls:**
```typescript
// Submit rating
const response = await ratingsApi.rateDriver(tripId, {
  rating: 5,
  comment: 'Great ride!',
  tags: ['friendly', 'clean_car', 'safe_driving'],
  tip_amount: 2.50
})

// Submit tip separately
const tipResponse = await ratingsApi.submitTip({
  tripId: tripId,
  amount: 2.50
})

// Get trip receipt
const receiptResponse = await paymentsApi.getTripReceipt(tripId)
// Returns: { receipt: TripReceipt }
```

---

### 4. Profile Management Flow

#### Screens & Navigation

**Entry Point:** `ProfileScreen`

```typescript
// Navigation structure
RiderNavigator
  â”œâ”€â”€ Profile
  â”œâ”€â”€ EditProfile
  â”œâ”€â”€ EmergencyContacts
  â”œâ”€â”€ SavedPlaces
  â”œâ”€â”€ PaymentMethods
  â”œâ”€â”€ PromoCode
s
  â”œâ”€â”€ Wallet
  â”œâ”€â”€ TripHistory
  â”œâ”€â”€ Settings
  â”œâ”€â”€ HelpCenter
  â”œâ”€â”€ ContactUs
  â”œâ”€â”€ TermsOfService
  â”œâ”€â”€ PrivacyPolicy
  â””â”€â”€ SafetyCenter
```

---

#### Profile Management APIs

```typescript
// Get profile
const response = await riderApi.getProfile()
// Returns: { rider: Rider, preferences, stats }

// Update profile
const response = await riderApi.updateProfile({
  first_name: string,
  last_name: string,
  phone: string
})

// Upload profile photo
const formData = new FormData()
formData.append('photo', photoFile)
const response = await riderApi.uploadProfilePhoto(formData)
```

---

#### Emergency Contacts

```typescript
// Get emergency contacts
const response = await riderApi.getEmergencyContacts()
// Returns: EmergencyContact[]

// Add emergency contact
const response = await riderApi.addEmergencyContact({
  name: string,
  phone: string,
  relationship: 'spouse' | 'parent' | 'sibling' | 'child' | 'friend' | 'other'
})

// Update emergency contact
const response = await riderApi.updateEmergencyContact(contactId, {
  name?: string,
  phone?: string,
  relationship?: string
})

// Delete emergency contact
const response = await riderApi.deleteEmergencyContact(contactId)
```

---

#### Payment Methods

```typescript
// Get payment methods
const response = await paymentsApi.getPaymentMethods()
// Returns: { methods: PaymentMethod[], default_method_id }

// Add card
const response = await paymentsApi.addPaymentMethod({
  type: 'card',
  card_number: string,
  expiry_month: number,
  expiry_year: number,
  cvv: string,
  cardholder_name: string
})

// Add mobile money
const response = await paymentsApi.addPaymentMethod({
  type: 'mobile_money',
  mobile_number: string,
  provider: 'ecocash' | 'onemoney' | 'innbucks'
})

// Set default payment method
const response = await paymentsApi.setDefaultPaymentMethod(methodId)
```

---

#### Wallet Management

```typescript
// Get wallet balance
const response = await riderApi.getWallet()
// Returns: { balance, currency, pending_balance }

// Add funds
const response = await riderApi.addFundsToWallet({
  amount: number,
  payment_method_id: string
})
```

---

#### Saved Places

```typescript
// Get saved places
const response = await profileApi.getSavedPlaces()
// Returns: SavedPlace[]

// Add saved place
const response = await profileApi.addSavedPlace({
  name: string,
  type: 'home' | 'work' | 'gym' | 'school' | 'other',
  address: string,
  latitude: number,
  longitude: number
})
```

---

## Driver Flow

### Overview
Driver app uses `DriverMapScreen` as a unified hub - everything happens on one screen with a dynamic bottom panel. No navigation away except for specific tasks.

---

### 1. Going Online Flow

#### Phase: OFFLINE
**Screen:** `DriverMapScreen` (Offline Status)

**UI Elements:**
- Map showing driver location
- Large "GO ONLINE" button (with pulse animation)
- Today's stats (trips: 0, earnings: $0.00, hours: 0h)
- Status badge: "Offline"

**User Actions:**
1. Tap "GO ONLINE" button
2. System checks:
   - Vehicle selected
   - Documents verified
   - Location permission
   - Background location enabled

**API Calls:**
```typescript
// Go online
const response = await driverApi.goOnline({
  latitude: number,
  longitude: number,
  vehicle_id: string
})
// Returns: { is_online: true, online_since: timestamp }

// Start background location tracking
await backgroundLocationService.start(driverId)

// Start location updates
setInterval(async () => {
  await driverApi.updateLocation({
    latitude: number,
    longitude: number,
    heading: number,
    speed: number,
    accuracy: number
  })
}, 5000)
```

---

#### Phase: ONLINE_AVAILABLE
**Screen:** `DriverMapScreen` (Online Status)

**UI Elements:**
- Status badge: "Online" (green with glow animation)
- Today's stats updated
- "GO OFFLINE" button
- Nearby trips overlay (minimizable)
  - Shows available trips as cards
  - Each card: pickup/dropoff, fare, distance
  - "Place Bid" button per trip

**Polling for Trips:**
```typescript
// Poll for available trips (every 10 seconds)
const tripPollInterval = setInterval(async () => {
  const response = await driverApi.getAvailableTrips({
    latitude: currentLocation.latitude,
    longitude: currentLocation.longitude,
    radius_km: 5
  })
  setAvailableTrips(response.data?.trips || [])
}, 10000)

// Poll for my bids (every 5 seconds)
const bidPollInterval = setInterval(async () => {
  const response = await driverApi.getMyBids(driverId)
  setMyBids(response.data || [])
  
  // Check for newly accepted bids
  const acceptedBid = myBids.find(bid => bid.status === 'accepted')
  if (acceptedBid) {
    // Bid accepted! Load trip details
    handleBidAccepted(acceptedBid.trip_id)
  }
}, 5000)
```

---

### 2. Accepting Trips Flow

#### Viewing Trip Requests
**Screen:** `DriverMapScreen` with `MinimalTripCard` overlay

**Trip Card UI:**
- Pickup address
- Dropoff address
- Estimated fare
- Distance
- Vehicle type
- Bidding section (expandable)

**User Actions:**
1. View trip details on card
2. Expand bidding section
3. Enter bid amount
4. Optional: Add message
5. Tap "Submit Bid"

**API Calls:**
```typescript
// Place bid
const response = await driverApi.placeBid({
  trip_id: string,
  amount: number,
  eta_minutes: number,
  message: string (optional)
})
// Returns: Bid

// Alternative: Navigate to full PlaceBidScreen modal
navigation.navigate('PlaceBid', { tripId })
```

---

#### Bid Accepted Notification
**Real-time Event:**
```typescript
// Via polling (bid status changed to 'accepted')
const acceptedBid = myBids.find(bid => bid.status === 'accepted')

// Via WebSocket/Pusher (if configured)
pusherService.onBidAccepted(tripId, (data) => {
  // Vibrate + sound + visual notification
  Vibration.vibrate([200, 100, 200])
  scheduleLocalNotification({
    title: 'Trip Accepted!',
    body: 'Your bid was accepted. Navigate to pickup.'
  })
})
```

---

### 3. During Trip Flow

#### Phase: ACCEPTED / ARRIVING
**Screen:** `DriverMapScreen` (Active Trip Panel)

**Map Visualization:**
- **Driver marker** (car icon) at driver's current location (your position)
- **Pickup marker** (green pin) at rider's pickup location
- **Route polyline** (black line) from driver â†’ rider's pickup location
- Camera auto-adjusts to show both driver and pickup in view
- Route updates automatically as you drive
- ETA/Distance pill at top of map

**Bottom Panel UI:**
- Trip status: "Heading to Pickup"
- Rider info (name, rating, photo)
- Pickup address
- "Navigate" button (opens Google Maps)
- "I've Arrived" button
- "Call Rider" and "Chat" buttons

**User Actions:**
1. Tap "Navigate" â†’ Opens Google Maps with turn-by-turn navigation
2. Drive to pickup location
3. When arrived, tap "I've Arrived"

**API Calls:**
```typescript
// Get trip details
const response = await tripsApi.getTripDetails(tripId)
// Returns: Trip with rider, pickup, dropoff details

// Open Google Maps navigation
await openGoogleMapsNavigation(pickup.latitude, pickup.longitude)
// Opens: google.navigation:q=lat,lng&mode=d (Android)
//    or: comgooglemaps://?daddr=lat,lng&directionsmode=driving (iOS)
//    or: https://www.google.com/maps/dir/?api=1&destination=lat,lng (Web fallback)

// Update status to "arrived"
const response = await driverApi.arriveAtPickup(tripId)
// Returns: Trip with status 'arrived'
```

**Route Fetching:**
```typescript
// Fetch actual driving route from Google Directions API
// Called after bid acceptance to show route from driver to pickup
const fetchDrivingRoute = async (originLat, originLng, destLat, destLng) => {
  const url = `https://maps.googleapis.com/maps/api/directions/json?origin=${originLat},${originLng}&destination=${destLat},${destLng}&mode=driving&key=${GOOGLE_API_KEY}`
  
  const response = await fetch(url)
  const data = await response.json()
  
  if (data.status === 'OK') {
    const route = data.routes[0]
    const polyline = route.overview_polyline.points
    const decodedCoords = decodePolyline(polyline)
    
    // Set route polyline on map (black for driver, blue for rider view)
    setRouteCoordinates(decodedCoords)
    
    const distanceKm = route.legs[0].distance.value / 1000
    const durationMin = Math.ceil(route.legs[0].duration.value / 60)
    setDistance(distanceKm)
    setEta(durationMin)
    
    // Adjust camera to show entire route
    const bounds = calculateBounds([...decodedCoords, { latitude: destLat, longitude: destLng }])
    mapRef.current?.fitToCoordinates(bounds, {
      edgePadding: { top: 50, right: 50, bottom: 300, left: 50 },
      animated: true
    })
  }
}

// For Rider: Fetch route from driver's location to pickup
useEffect(() => {
  if (phase === 'driver_assigned' && driverLocation && pickupLocation) {
    fetchDrivingRoute(
      driverLocation.latitude,
      driverLocation.longitude,
      pickupLocation.latitude,
      pickupLocation.longitude
    )
  }
}, [phase, driverLocation, pickupLocation])

// For Driver: Fetch route from your location to rider's pickup
useEffect(() => {
  if (tripStatus === 'accepted' && currentLocation && trip?.pickup) {
    fetchDrivingRoute(
      currentLocation.latitude,
      currentLocation.longitude,
      trip.pickup.latitude,
      trip.pickup.longitude
    )
  }
}, [tripStatus, currentLocation, trip])
```

---

#### Phase: ARRIVED (Waiting for Rider)
**Screen:** `DriverMapScreen` (Arrived Panel)

**UI Elements:**
- Status: "Waiting for Rider"
- "Rider has been notified"
- "Start Trip" button (enabled once rider boards)
- Timer showing wait time

**User Actions:**
1. Wait for rider to arrive
2. Verify rider identity
3. Tap "Start Trip" when rider boards

**API Calls:**
```typescript
// Start trip
const response = await driverApi.startTrip(tripId)
// Returns: Trip with status 'in_progress'

// Update location continuously
setInterval(async () => {
  await trackingApi.updateLocation({
    latitude: currentLocation.latitude,
    longitude: currentLocation.longitude,
    heading: heading,
    speed: speed
  })
}, 5000)
```

---

#### Phase: IN_PROGRESS
**Screen:** `DriverMapScreen` (Trip In Progress Panel)

**UI Elements:**
- Map with route to dropoff
- Route polyline (black)
- Dropoff marker
- ETA/Distance pill
- Bottom panel:
  - Status: "Trip in Progress"
  - Dropoff address
  - "Navigate" button (to dropoff)
  - "Complete Trip" button (enabled near destination)
  - Trip info: Fare, Distance

**User Actions:**
1. Drive to dropoff location
2. When arrived, tap "Complete Trip"

**Navigation:**
```typescript
// Open Google Maps to dropoff
await openGoogleMapsNavigation(dropoff.latitude, dropoff.longitude)
```

---

### 4. Completing Trip Flow

#### Phase: ARRIVING_AT_DESTINATION
**Screen:** `DriverMapScreen` (Near Completion)

**UI Elements:**
- "Complete Trip" button becomes prominent
- Final distance/fare display

**User Actions:**
1. Tap "Complete Trip"
2. App shows completion form

---

#### Completion Form
**Screen:** `DriverMapScreen` (Completion Panel) OR `CompleteTripScreen` (Modal)

**UI Elements:**
- Trip summary (route, distance, fare)
- Rate rider (1-5 stars)
- Optional note/feedback
- "Complete & Finish" button

**API Calls:**
```typescript
// Complete trip
const response = await driverApi.completeTrip(tripId, {
  final_latitude: number,
  final_longitude: number,
  final_distance_km: number,
  duration_minutes: number
})
// Returns: Trip with status 'completed', final_fare

// Rate rider
const response = await ratingsApi.ratePassenger(tripId, {
  rating: number,
  comment: string (optional),
  tags: string[] (optional)
})
```

**Post-Completion:**
```typescript
// Fetch updated earnings
const response = await driverApi.getDashboard()
setTodayEarnings(response.data.today_earnings)
setTodayTrips(response.data.today_trips)

// Reset trip state
setActiveTrip(null)
setTripStatus('none')
setStatus('online') // Back to available
```

---

### 5. Earnings & Management

#### Earnings Screen
**Screen:** `EarningsScreen`

**UI Elements:**
- Today's earnings
- This week/month earnings
- Earnings breakdown (base fare, tips, bonuses)
- Earnings history
- "Request Payout" button

**API Calls:**
```typescript
// Get earnings overview
const response = await driverApi.getEarningsOverview()
// Returns: { 
//   today_earnings, 
//   week_earnings, 
//   month_earnings,
//   pending_balance,
//   available_balance
// }

// Get earnings history
const response = await driverApi.getEarningsHistory(fromDate, toDate)
// Returns: { 
//   earnings: [{ date, amount, trips }],
//   total
// }

// Get balance
const response = await driverApi.getBalance()
// Returns: { available, pending, currency }

// Request instant payout
const response = await driverApi.requestInstantPayout(amount)
// Returns: { payout_id, status }
```

---

#### Daily Fee Management
**Screen:** `DailyFeeScreen`

**Purpose:** Pay daily rental/platform fee to activate vehicle for the day

**API Calls:**
```typescript
// Get daily fee status
const response = await driverApi.getDailyFeeStatus()
// Returns: { 
//   fee_amount,
//   paid_today,
//   can_go_online,
//   payment_due_date
// }

// Pay daily fee
const response = await driverApi.payDailyFee(vehicleId)
// Returns: { receipt, remaining_balance }
```

---

#### Vehicle Management
**Screen:** `VehiclesScreen`

**API Calls:**
```typescript
// Get vehicles
const response = await driverApi.getVehicles()
// Returns: Vehicle[]

// Add vehicle
const response = await driverApi.addVehicle({
  make: string,
  model: string,
  year: number,
  color: string,
  license_plate: string,
  vehicle_type: 'economy' | 'standard' | 'premium' | 'suv',
  seats: number
})

// Update vehicle
const response = await driverApi.updateVehicle(vehicleId, {
  is_active: boolean
})

// Upload vehicle photos
const formData = new FormData()
formData.append('photo', photoFile)
const response = await driverApi.uploadVehiclePhotos(vehicleId, formData)
```

---

#### Document Management
**Screen:** `DocumentsScreen`

**API Calls:**
```typescript
// Get documents
const response = await driverApi.getDocuments()
// Returns: Document[] with status (pending, approved, rejected)

// Upload document
const formData = new FormData()
formData.append('document_type', 'drivers_license')
formData.append('file', fileData)
formData.append('expiry_date', '2025-12-31')
const response = await driverApi.uploadDocument(formData)

// Get expiring documents
const response = await driverApi.getExpiringDocuments()
// Returns: Document[] expiring within 30 days
```

---

## API Endpoints Reference

### Rider Endpoints

| Method | Endpoint | Purpose |
|--------|----------|---------|
| POST | `/api/mobile/v1/rider/booking/estimate` | Estimate fare |
| POST | `/api/mobile/v1/rider/booking` | Book trip |
| POST | `/api/mobile/v1/rider/booking/nearby-drivers` | Get nearby drivers |
| GET | `/api/mobile/v1/rider/trips/current` | Get current trip |
| GET | `/api/mobile/v1/rider/trips/{tripId}` | Get trip details |
| GET | `/api/mobile/v1/rider/trips/bids/{tripId}` | Get bids for trip |
| POST | `/api/mobile/v1/rider/trips/{tripId}/bids/{bidId}` | Accept bid |
| POST | `/api/mobile/v1/rider/trips/{tripId}/cancel` | Cancel trip |
| GET | `/api/mobile/v1/rider/trips/history` | Trip history |
| GET | `/api/mobile/v1/rider/profile` | Get profile |
| PUT | `/api/mobile/v1/rider/profile` | Update profile |
| GET | `/api/mobile/v1/rider/profile/emergency-contacts` | Get emergency contacts |
| POST | `/api/mobile/v1/rider/profile/emergency-contacts` | Add emergency contact |
| POST | `/api/mobile/v1/rider/ratings/driver/{tripId}` | Rate driver |
| POST | `/api/mobile/v1/rider/ratings/driver/{tripId}/tip` | Add tip |
| GET | `/api/mobile/v1/rider/tracking/trip/{tripId}/location` | Get driver location |
| GET | `/api/mobile/v1/rider/tracking/trip/{tripId}/eta` | Get ETA |
| POST | `/api/mobile/v1/rider/safety/trip/{tripId}/share` | Share trip |
| POST | `/api/mobile/v1/rider/safety/emergency/trigger` | Trigger emergency |

### Driver Endpoints

| Method | Endpoint | Purpose |
|--------|----------|---------|
| GET | `/api/mobile/v1/driver/dashboard/overview` | Get dashboard |
| POST | `/api/mobile/v1/driver/status/online` | Go online |
| POST | `/api/mobile/v1/driver/status/offline` | Go offline |
| POST | `/api/mobile/v1/driver/status/location` | Update location |
| GET | `/api/mobile/v1/driver/trips/available` | Get available trips |
| POST | `/api/mobile/v1/driver/trips/bids/{tripId}` | Place bid |
| GET | `/api/mobile/v1/driver/trips/bids` | Get my bids |
| POST | `/api/driver/trips/{tripId}/accept` | Accept trip |
| POST | `/api/driver/trips/{tripId}/arrive` | Arrive at pickup |
| POST | `/api/driver/trips/{tripId}/start` | Start trip |
| POST | `/api/driver/trips/{tripId}/complete` | Complete trip |
| POST | `/api/driver/trips/{tripId}/cancel` | Cancel trip |
| GET | `/api/driver/trips/current` | Get current trip |
| GET | `/api/mobile/v1/driver/trips/history` | Trip history |
| GET | `/api/driver/earnings/overview` | Get earnings |
| GET | `/api/driver/earnings/balance` | Get balance |
| POST | `/api/driver/earnings/instant-payout` | Request payout |
| GET | `/api/driver/vehicles` | Get vehicles |
| POST | `/api/driver/vehicles` | Add vehicle |
| GET | `/api/driver/documents` | Get documents |
| POST | `/api/driver/documents` | Upload document |

---

## Real-time Updates

### Pusher/WebSocket Channels

#### Rider Channels

```typescript
// Subscribe to trip channel
pusherService.subscribeToTrip(tripId)

// Events
- 'trip.status.changed' â†’ { trip_id, status, timestamp }
- 'driver.location.updated' â†’ { latitude, longitude, heading, eta_minutes }
- 'driver.arrived' â†’ { trip_id, arrived_at }
- 'message.received' â†’ { message_id, text, sender, timestamp }
- 'bid.received' â†’ { bid_id, driver_id, amount, eta }
```

#### Driver Channels

```typescript
// Subscribe to driver channel
pusherService.subscribeToDriver(driverId)

// Events
- 'trip.created' â†’ { trip_id, pickup, dropoff, fare }
- 'trip.cancelled' â†’ { trip_id }
- 'bid.accepted' â†’ { bid_id, trip_id }
- 'bid.rejected' â†’ { bid_id, trip_id }
- 'message.received' â†’ { message_id, text, sender }
```

### Hooks for Real-time

```typescript
// Rider hooks
const { tripStatus, driverLocation } = useTripUpdates(tripId)
const { location, eta } = useDriverLocation(tripId)
const { bids, latestBid, newBidCount } = useBids(tripId)
const { messages, isTyping } = useTripChat(tripId)

// Driver hooks
const { pendingTrips, latestRequest } = useDriverTripRequests(driverId)
const { paymentUpdates } = usePaymentNotifications(userId)
```

---

## State Management

### Redux Slices

```typescript
// Auth Slice
interface AuthState {
  user: User | null
  driver: Driver | null
  userType: 'rider' | 'driver'
  token: string | null
  isAuthenticated: boolean
}

// Trip Slice
interface TripState {
  currentTrip: Trip | null
  fareEstimate: FareEstimate | null
  isEstimating: boolean
  isLoading: boolean
  availableTrips: Trip[]
  tripHistory: Trip[]
}

// Location Slice
interface LocationState {
  pickupLocation: Location | null
  pickupAddress: string
  dropoffLocation: Location | null
  dropoffAddress: string
  currentLocation: Location | null
}
```

### State Machines

```typescript
// Rider State Machine
enum RiderState {
  IDLE,
  ENTERING_DESTINATION,
  VIEWING_FARE,
  NEGOTIATING,
  WAITING_DRIVER,
  DRIVER_ASSIGNED,
  DRIVER_ARRIVED,
  RIDE_STARTED,
  RIDE_COMPLETED,
  PAYMENT_PENDING,
  PAYMENT_COMPLETE,
  RATING
}

// Driver State Machine
enum DriverState {
  OFFLINE,
  GOING_ONLINE,
  ONLINE_AVAILABLE,
  VIEWING_REQUEST,
  DECIDING,
  ACCEPTED,
  NAVIGATING_TO_PICKUP,
  ARRIVED_AT_PICKUP,
  RIDE_STARTED,
  NAVIGATING_TO_DESTINATION,
  ARRIVED_AT_DESTINATION,
  RIDE_COMPLETED,
  SETTLEMENT
}
```

---

## Map Implementation Reference

**See:** [MAP_IMPLEMENTATION_GUIDE.md](MAP_IMPLEMENTATION_GUIDE.md) for comprehensive details on:
- Uniform marker types and icons
- Polyline styles and colors
- Camera behaviors and animations
- Reusable map components
- Implementation examples
- Asset specifications

**Key Standards:**
- **Blue polyline** (#1E88E5) - Driver â†’ Pickup
- **Black polyline** (#000000) - Driver â†’ Destination (in progress)
- **Green dashed** (#34A853) - Estimated route (fare preview)
- **Gray** (#9E9E9E) - Completed/historical routes

**Markers:**
- Green pin - Pickup location
- Red pin - Dropoff/Destination
- Blue circle - User location
- Car icons - Drivers (gray=available, black/orange=active)

All maps across Rider and Driver apps use identical marker types, colors, and behaviors for consistency.

---

## Summary

### Rider Journey
1. **Open app** â†’ See map with nearby drivers
2. **Search destination** â†’ Enter address or pick on map
3. **View fare** â†’ Select vehicle type, review/adjust fare
4. **Book ride** â†’ Tap "Find Ride"
5. **Wait for bids** â†’ See incoming driver bids (real-time)
6. **Review bids** â†’ Compare drivers (fare, rating, ETA, vehicle)
7. **Accept bid** â†’ Select preferred driver and accept
8. **Driver assigned** â†’ Track driver in real-time to pickup
9. **Trip starts** â†’ Navigate to destination
10. **Trip ends** â†’ Rate driver, add tip
11. **Done** â†’ View receipt, repeat

### Driver Journey
1. **Go online** â†’ Tap "GO ONLINE" button
2. **View trips** â†’ See available trips, place bids
3. **Bid accepted** â†’ Get notification, view trip details
4. **Navigate to pickup** â†’ Use Google Maps turn-by-turn
5. **Arrive & wait** â†’ Tap "I've Arrived", wait for rider
6. **Start trip** â†’ Tap "Start Trip", navigate to dropoff
7. **Complete trip** â†’ Tap "Complete Trip", rate rider
8. **Earnings updated** â†’ Back to online/available status
9. **Go offline** â†’ End shift, view earnings

---

## Next Steps

1. **Implement Missing Features:**
   - Scheduled rides
   - Shared trips (carpooling)
   - In-app calling/chat
   - Payment processing

2. **Optimize Performance:**
   - Reduce API polling frequency
   - Implement WebSocket/Pusher fully
   - Cache frequently accessed data

3. **Enhance UX:**
   - Add haptic feedback
   - Improve loading states
   - Better error handling
   - Offline mode support

4. **Testing:**
   - End-to-end flow testing
   - Real-time sync testing
   - Payment flow testing
   - Location accuracy testing

---

**Document Version:** 1.0  
**Last Review:** January 2026  
**Maintained By:** Hande Development Team
